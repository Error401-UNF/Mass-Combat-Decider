name: Linux

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04 # Use an older LTS for better compatibility
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-4-dev libadwaita-1-dev libglib2.0-dev pkg-config build-essential

      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Build Release
        run: cargo build --release

      - name: Strip Binary
        run: strip target/release/MassCombatDecider

      - name: Build AppImage (Manual)
        uses: AppImageCrafters/build-appimage-action@v2
        with:
          recipe: |
            version: 1
            AppDir:
              path: ./AppDir
              app_info:
                id: mass-combat-decider
                name: MassCombatDecider
                icon: utilities-terminal
                exec: bin/MassCombatDecider
              runtime:
                generator: wrapper
              apt:
                include:
                  - libgtk-4-1
                  - libadwaita-1-0
            AppImage:
              arch: x86_64
              update-information: None